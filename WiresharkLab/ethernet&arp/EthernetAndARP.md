# Wireshark实验 - EthernetAndARP

**官方英文文档：[Wireshark_Ethernet_ARP_v8.1.doc](https://www-net.cs.umass.edu/wireshark-labs/Wireshark_Ethernet_ARP_v8.1.doc)**

**trace文件：[ethernet-wireshark-trace1](http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces-8.1.zip)**

## 1. 捕获并分析以太网帧

**1.你电脑的48位以太网地址是什么？**

<img src='.\Figure\ethernet-1.png'>

答：如上图，c4:41:1e:75:b1:52。

**2.以太网帧中的48位目的地址是什么？这个地址是gaia.cs.umass.edu的以太网地址吗？（提示：答案是否定的）。哪个设备拥有这个以太网地址？[注意：这是一个重要的问题，学生们有时会答错。重读教材第483-484页，并确保你理解这里的答案。]**

答：如上图，`00:1e:c1:7e:d9:01`，不是`gaia.cs.umass.edu`的以太网地址，而是本地网关的以太网地址。

**3.携带HTTP GET请求的以太网帧中，两字节帧类型字段的十六进制值是什么？这对应哪个上层协议？**

答：如上图，类型值为`0x0800`，对应于`IPv4`协议。

**4.从以太网帧的最开始算起，ASCII码“G”（在“GET”中的“G”）在以太网帧中出现的位置是多少字节？不要在你的计数中包括任何前导位，即假设以太网帧从目的地址开始。**

<img src='.\Figure\ethernet-2.png'>

答：如上图，是在第67字节出现。

**5.以太网源地址的值是什么？这是你电脑的地址还是gaia.cs.umass.edu的地址？（提示：答案是否定的）。哪个设备拥有这个以太网地址？**

<img src='.\Figure\ethernet-3.png'>

答：如上图，以太网源地址为`00:1e:c1:7e:d9:01`，都不是，这是本地网关的地址。

**6.以太网帧中的目的地址是什么？这是你电脑的以太网地址吗？ **

答；以太网目的地址为`c4:41:1e:75:b1:52`,是本电脑的以太网地址。

**7. 给出两字节帧类型字段的十六进制值。这对应哪个上层协议？**

答：如上图，类型字段值为`0x0800`,对应于`IPv4`。

**8.从以太网帧的最开始算起，ASCII码“O”（在“OK”中的“O”）在以太网帧中出现的位置是多少字节？不要在你的计数中包括任何前导位，即假设以太网帧从目的地址开始。 **

<img src='.\Figure\ethernet-4.png'>

答：如上图，出现的位置是第80字节。

**9. 有多少个以太网帧（每个帧包含一个IP数据报，每个数据报包含一个TCP段）携带了完整HTTP “OK 200 ...”响应消息的一部分数据？**

<img src='.\Figure\ethernet-5.png'>

答：一共有5个以太网帧携带了完整HTTP “OK 200 ...”响应消息的一部分数据。

## ARP协议

### ARP缓存

**10.你的ARP缓存中存储了多少条目？**

<img src='.\Figure\arp-1.png'>

答：如上图，存储了两条。

**11.每个显示的ARP缓存条目中包含了什么内容？**

答：第一个`xiaoqiang`是本地网关，第二个是本地路由器的一个逻辑接口。

### 观察ARP的实际操作

**12.你计算机发送的ARP请求消息所包含的以太网帧中的源地址的十六进制值是什么？**

<img src='.\Figure\arp-2.png'>

答：如上图，源地址的十六进制值为`c4:41:1e:75:b1:52`。

**13.你计算机发送的ARP请求消息所包含的以太网帧中的目标地址的十六进制值是什么？与该地址对应的设备是什么（例如，客户端、服务器、路由器、交换机或其他设备）？**

答：如上图，目的地址的十六进制值为`ff:ff:ff:ff:ff:ff`，对应于本地局域网中的所有设备。

**14.以太网帧类型字段的两字节十六进制值是什么？这对应于哪个上层协议？**

答：如上图，类型字段值为`0x0806`，对应于ARP协议。

**15.从以太网帧的起始位置算起，ARP操作码字段从第几字节开始？**

<img src='.\Figure\arp-3.png'>

答：如上图，从第21字节开始。

**16.你计算机发送的ARP请求消息中的操作码字段的值是多少？**

答：如上图，操作码字段值为1。

**17.ARP请求消息中是否包含发送者的IP地址？如果答案是肯定的，该值是多少？**

答：包含，该值为`128.119.247.66`。

**18.你计算机发送的ARP请求消息中，所请求的与之对应的以太网地址的设备的IP地址是多少？**

答：如上图，IP地址为`128.119.247.1`。

**19.你计算机收到的ARP回复消息中的操作码字段的值是多少？**

<img src='.\Figure\arp-4.png'>

答：如上图，操作码字段值为2。

**20.在你计算机发送的ARP请求消息中指定的IP地址对应的以太网地址是什么（参见问题18）？**

答：如上图，对于以太网地址为`00:1e:c1:7e:d9:01`。

**21.我们已经查看了你计算机运行Wireshark时发送的ARP请求消息和响应发送的ARP回复消息。但在跟踪中，你没有看到对其他设备发送的ARP请求消息的回复。这是为什么？**

答：没有，因为对对其他设备发送的ARP请求消息的回复的目的MAC地址不是本机MAC地址，会被丢弃。

### 额外问题

**1.arp命令：`arp -s InetAddr EtherAddr`允许你手动向ARP缓存中添加一个条目，将IP地址`InetAddr`解析为物理地址`EtherAddr`。如果你在手动添加条目时，输入了正确的IP地址，但为远程接口输入了错误的以太网地址，会发生什么？一种名为“ARP欺骗”的安全攻击（详见：https://www.varonis.com/blog/arp-poisoning/）会伪造ARP消息，并导致ARP表中出现错误的条目！**

答：如果手动添加了一个错误的ARP条目，将正确的IP地址与错误的以太网地址关联，那么计算机将错误地将网络流量发送到错误的物理设备。这可能导致无法访问目标设备，或将数据发送到攻击者控制的设备，从而可能导致数据泄露、网络中断或其他安全风险。这种行为就是ARP欺骗攻击的核心机制，攻击者通过伪造ARP消息将自己伪装成合法设备，从而劫持流量或执行中间人攻击。

**2.ARP缓存中的条目在被移除前的默认保留时间是多少？你可以通过监控缓存内容的变化来确定这个时间，也可以查阅你的操作系统文档来查找该值。请说明你是如何/从哪里确定这个值的。**

<img src='.\Figure\arp-5.png'>

答：默认情况下，ARP缓存中的条目通常会在20分钟（1200秒）后过期并被移除。这一时间间隔可能因操作系统的不同而有所不同。对于`Ubuntu 22.04LTS`而言，如上图，这一事件为60秒。