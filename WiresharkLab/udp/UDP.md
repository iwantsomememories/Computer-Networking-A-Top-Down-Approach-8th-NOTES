# Wireshark实验 - UDP

**官方英文文档：[Wireshark_UDP_v8.1.doc](https://www-net.cs.umass.edu/wireshark-labs/Wireshark_UDP_v8.1.doc)**

**trace文件：[dns-wireshark-trace1-1](http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces-8.1.zip)**

## 使用nslookup查询主机名

**1.选择捕获文件中的第一个 UDP 数据包。此数据包在捕获文件中的数据包编号是多少？该 UDP 数据包承载了什么类型的应用层有效载荷或协议消息？查看 Wireshark 中此数据包的详细信息。UDP 头中有多少个字段？（不要参考教材！直接根据您在数据包捕获文件中观察到的内容回答这些问题。）这些字段的名称是什么？**

<img src=".\Figure\UDP1.png" />

答：数据包编号为15；该UDP数据包承载了DNS协议消息；UDP头包括四个字段，具体内容如下：

| 源端口 | 目的端口 | 长度 | 校验和 |
| ------ | -------- | ---- | ------ |
| 58350  | 53       | 43   | 0xc31d |

**2.通过查看 Wireshark 中该数据包的显示信息（或参考课本），UDP 头部字段的每个字段长度是多少字节？**

<img src=".\Figure\UDP2.png" />

答：如图可知，源端口字段长度为2个字节，其他字段长度相同。

**3.长度字段中的值表示什么的长度？（你可以参考课本以获得答案）。用你捕获的 UDP 数据包验证你的答案。**

答：表示整个UDP数据包的长度。如问题2中图所示，从源端口对应字节开始，直到数据包末尾，整好是43字节。

**4.UDP 负载中可以包含的最大字节数是多少？（提示：可以从上面第 2 个问题的答案中推断出此问题的答案）**

答：由于长度字段为2个字节，而UDP首部总长度为8个字节。2字节可表示的最大无符号数为$2^{16}-1$，于是负载中的最大字节数为$2^{16}-1-8 = 65527$字节。

**5.最大可能的源端口号是多少？（提示：参考第 4 个问题的提示）**

答：65535。

**6.UDP 的协议号是什么？请用十进制表示。要回答这个问题，你需要查看包含该 UDP 段的 IP 数据报的协议字段（参考课本图 4.13 及 IP 头字段的讨论）。**

<img src=".\Figure\UDP3.png" />

答：协议号为17。

**7.检查其中你的主机发送第一个 UDP 数据包，而第二个 UDP 数据包是对此第一个 UDP 数据包的回复的 UDP 数据包对。（提示：第二个数据包作为第一个数据包的响应，意味着第一个数据包的发送者应当是第二个数据包的接收者）。第一个 UDP 段在捕获文件中的数据包编号是什么？该 UDP 段的源端口字段的值是什么？目的端口字段的值是什么？第二个 UDP 段在捕获文件中的数据包编号是什么？第二个 UDP 段的源端口字段的值是什么？目的端口字段的值是什么？描述两个数据包中端口号之间的关系。**

答：如问题1中图所示。结果如下：

| 数据包编号 | 源端口号 | 目的端口号 |
| ---------- | -------- | ---------- |
| 15         | 58350    | 53         |
| 17         | 53       | 58350      |

第一个UDP段的源端口号对应于第二个UDP段的目的端口号，第一个UDP段的目的端口号对应于第二个UDP段的源端口号。