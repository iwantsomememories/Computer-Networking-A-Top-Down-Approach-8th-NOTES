# Wireshark实验 - IP

**官方英文文档：[Wireshark_IP_v8.1.doc](https://www-net.cs.umass.edu/wireshark-labs/Wireshark_IP_v8.1.doc)**

**trace文件：[ip-wireshark-trace1-1](http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces-8.1.zip),[ip-wireshark-trace2-1](http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces-8.1.zip)**

## IPv4基础

**1.选择你的计算机通过 `traceroute` 命令发送到 `gaia.cs.umass.edu `的第一个 UDP 段。你的计算机的 IP 地址是什么？**

<img src=".\Figure\IP-1.png" />

答：IP地址为192.168.86.61。

**2.此 IPv4 数据报头中的生存时间 (TTL) 字段中的值是多少？**

答：如上图，可知TTL字段值为1。

**3.此 IPv4 数据报头中的上层协议字段中的值是多少？**

答：如上图，可知上层协议字段值为17，表示UDP。

**4.IP 报头有多少字节？**

答：如上图，可知报头长度为20字节。

**5.IP 数据报的有效负载有多少字节？解释您如何确定有效负载字节数。**

答：如上图，可知IP数据报报头总长度为56字节，则有效负载字节数为56-20=36字节。

**6.此 IP 数据报是否已分段？解释您如何确定数据报是否已分段。**

<img src=".\Figure\IP-2.png" />

答：没有分段。由上图可知MF标志位为0，故该数据包并未分片。



**筛选条件为`ip.src==192.168.86.61 and ip.dst==128.119.245.12 and udp and !icmp`**

<img src=".\Figure\IP-3.png" />

**7.在你的计算机通过 `traceroute` 发送到 `128.119.245.12` 的这一系列 UDP 数据报中，IP 数据报的哪些字段总是会发生变化？为什么？**

答：16位比特标识、首部校验和总会发生变化，因为16位比特标识确定了每一个IP数据包的身份，而首部校验和也会随着首部内容的不同而不同。值得注意的是，将相邻的三个连续IP数据报划分为一组，则各组之间的TTL字段不同。

**8.在这一系列包含 UDP 段的 IP 数据报中，哪些字段保持不变？为什么？**

答：版本号、首部长度、服务类型、上层协议、源IP地址、目的IP地址；因为它们都是traceroute发往同一IP地址的一系列IP数据包。

**9.描述一下您的计算机发送的 IP 数据报中的标识字段的数值模式。**

答：首个IP数据报中标识字段值为`0xfda1`，后续所有未分片IP数据包以此为基础递增，每次增加1。



**筛选条件为`ip.dst==192.168.86.61 and icmp`**

<img src=".\Figure\IP-4.png" />

**10.从路由器返回的 IP 数据报中指定的上层协议是什么？**

答：如上图，可知上层协议为ICMP(1)。

**11.ICMP 包中标识字段的数值行为是否与您在第9题中的回答相似？**

答：相似，也是依次递增。

**12.所有路由器返回的 ICMP 包中 TTL 字段的数值是否相似？**

答：不同。

## 分片

**13.找到第一个 IP 数据报，它包含由你的计算机通过 `traceroute` 命令发送到 `128.119.245.12` 的段的第一部分（当您指定 `traceroute` 数据包长度应为 3000 字节时）。(提示：这是 `ip-wireshark-trace1-1.pcapng` 跟踪文件中的数据包 179。数据包 179、180 和 181 是通过将第一个 3000 字节的 UDP 段分段成三个 IP 数据报创建的)。这个段是否被分段到多个 IP 数据报中？**

<img src=".\Figure\IP-5.png" />

答：该段被分段到179、180、181三个数据报中，由上图可知这三个IP数据包标识字段值相同。

**14.IP 首部中的哪些信息表明这个数据报已经被分段？**

答：如上图，标志字段MF为1，表明后续还有分片。

**15.这个数据包的 IP 头部中哪些信息表明这是第一个分段还是后续分段？**

答：片偏移为0，则该数据包为第一个分段。

**16.这个 IP 数据报（头部加负载）的字节数是多少？**

答：如上图所示，总长度为1500字节。

**17.现在检查包含被分段的 UDP 段的第二个分片的数据报。IP 头部中的哪些信息表明这不是第一个数据报分片？**

<img src=".\Figure\IP-6.png" />

答：片偏移为1480，故该IP数据报不是第一个分片。

**18.在第一个和第二个分段之间，IP 头部中的哪些字段发生了变化？**

答：片偏移、首部校验和字段发生了变化。

**19.现在找到包含原始 UDP 段第三个分段的 IP 数据报。IP 头部中的哪些信息表明这是该数据报的最后一个分片？**

<img src=".\Figure\IP-7.png" />

答：标志位中MF值为0，表明后续没有分片，故该分片为该数据报的最后一个分片。

## IPv6

**20.发出 DNS AAAA 请求的计算机的 IPv6 地址是什么？这是跟踪中第 20 个数据包的源地址。请提供该数据报的 IPv6 源地址，格式与 Wireshark 窗口中显示的完全一致。**

<img src=".\Figure\IP-8.png" />

答：IPv6源地址为2601:193:8302:4620:215c:f5ae:8b40:a27a。

**21.该数据报的 IPv6 目标地址是什么？请提供该 IPv6 地址，格式与 Wireshark 窗口中显示的完全一致。**

答：如上图，IPv6 目标地址是2001:558:feed::1。

**22.该数据报的流标签（Flow Label）值是多少？**

答：如上图，流标签为0x63ed0。

**23.该数据报中携带了多少有效负载数据？**

答：如上图，有效负载为37字节。

**24.该数据报的有效负载将在目标地址处交付到哪个上层协议？**

答：交付给UDP协议。



**最后，找到跟踪中对第 20 个数据包中 IPv6 DNS AAAA 请求的 IPv6 DNS 响应。此 DNS 响应包含 `youtube.com` 的 IPv6 地址。**

**25.在对这个 AAAA 请求的响应中返回了多少个 IPv6 地址？**

<img src=".\Figure\IP-9.png" />

答：返回了一个IPv6地址。

**26.在 DNS 返回的 `youtube.com` 的 IPv6 地址中，第一个地址是什么？请以 Wireshark 窗口中显示的简写格式提供该 IPv6 地址。**

答：该IPv6地址为2607:f8b0:4006:815::200e。